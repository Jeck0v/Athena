# üèõÔ∏è Athena - Production-Ready DevOps Toolkit

[![Rust](https://img.shields.io/badge/Rust-1.70+-orange.svg)](https://www.rust-lang.org)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Version](https://img.shields.io/badge/Version-0.1.0-green.svg)](Cargo.toml)

**Athena** is a powerful CLI toolkit that combines two essential DevOps tools:
1. **Docker Compose Generator** - Convert COBOL-inspired DSL to production-ready Docker Compose
2. **Boilerplate Project Generator** - Create full-stack applications with FastAPI, Go, Flask

Built with performance and maintainability in mind, Athena uses intelligent defaults and modern Docker standards to generate optimized configurations with minimal configuration.

## üìã Table of Contents

- [üöÄ Quick Start](#-quick-start)
- [‚ú® Key Features](#-key-features)
- [üì¶ Installation](#-installation)
- [üèóÔ∏è Docker Compose Generator](#Ô∏è-docker-compose-generator)
- [üß¨ Boilerplate Project Generator](#-boilerplate-project-generator)
- [üìñ DSL Reference](#-dsl-reference)
- [üéØ Examples](#-examples)
- [üèóÔ∏è Architecture](#Ô∏è-architecture)
- [üîß Development](#-development)

## üöÄ Quick Start

### Installation
```bash
# Install from source
git clone https://github.com/your-org/athena.git
cd athena
cargo install --path .

# Verify installation
athena --version
```

### Generate Docker Compose (90% less configuration!)
```bash
# Create a simple deploy.ath file
echo 'DEPLOYMENT-ID MY_APP

SERVICES SECTION

SERVICE backend
PORT-MAPPING 8000 TO 8000
ENV-VARIABLE {{DATABASE_URL}}
END SERVICE

SERVICE database
IMAGE-ID postgres:15
END SERVICE' > deploy.ath

# Generate production-ready docker-compose.yml
athena build deploy.ath
```

### Generate Full-Stack Project
```bash
# Create FastAPI + PostgreSQL project
athena init fastapi my-api --with-postgresql

# Create Go + MongoDB microservice
athena init go my-service --framework gin --with-mongodb
```

## ‚ú® Key Features

### üéØ **Intelligent Defaults 2025+**
- **No more `version` field** - Modern Docker Compose spec compliance
- **Auto-detects service types** - Database, Cache, WebApp, Proxy patterns
- **Smart restart policies** - `always` for databases, `unless-stopped` for apps
- **Optimized health checks** - Different intervals per service type
- **Container naming** - Follows modern conventions (`project-service`)

### üê≥ **Docker-First Approach**
- **Dockerfile by default** - No image? Uses `build.dockerfile: Dockerfile` 
- **Intelligent networking** - Auto-configured networks with proper isolation
- **Production-ready** - Security, resource limits, and health monitoring
- **Standards compliant** - Follows Docker Compose 2025 best practices

### ‚ö° **Performance Optimized**
- **Topological sorting** - Services ordered by dependencies automatically
- **Iterative validation** - Fast circular dependency detection
- **Optimized parsing** - <1ms parse time, <2ms generation
- **Memory efficient** - Pre-allocated structures for large compositions

### üß¨ **Full-Stack Boilerplates**
- **FastAPI + PostgreSQL/MongoDB** - Production authentication, async drivers
- **Go + Gin/Echo/Fiber** - Clean architecture, proper middleware
- **Flask + PostgreSQL** - Modern Python web development
- **Docker ready** - Multi-stage builds, Nginx reverse proxy included

## üì¶ Installation

### Prerequisites
- Rust 1.70+ 
- Docker & Docker Compose (for testing generated files)

### Install from Source
```bash
git clone https://github.com/your-org/athena.git
cd athena
cargo install --path .
```

### Verify Installation
```bash
athena --version        # Check version
athena info --examples # View DSL examples
which athena           # Should show: ~/.cargo/bin/athena
```

## üèóÔ∏è Docker Compose Generator

Transform minimal `.ath` configuration into production-ready Docker Compose files.

### Basic Usage
```bash
athena build deploy.ath              # Generate docker-compose.yml
athena build deploy.ath -o custom.yml   # Custom output file
athena validate deploy.ath           # Validate syntax only
```

### Example Input/Output

**Input (`deploy.ath`):**
```cobol
DEPLOYMENT-ID FASTAPI_PROJECT
VERSION-ID 2.0.0

ENVIRONMENT SECTION
NETWORK-NAME fastapi_network

SERVICES SECTION

SERVICE backend
PORT-MAPPING 8000 TO 8000
ENV-VARIABLE {{DATABASE_URL}}
COMMAND "uvicorn app.main:app --host 0.0.0.0 --port 8000"
DEPENDS-ON database
HEALTH-CHECK "curl -f http://localhost:8000/health || exit 1"
RESOURCE-LIMITS CPU "1.0" MEMORY "1024M"
END SERVICE

SERVICE database
IMAGE-ID postgres:15
PORT-MAPPING 5432 TO 5432
ENV-VARIABLE {{POSTGRES_USER}}
ENV-VARIABLE {{POSTGRES_PASSWORD}}
VOLUME-MAPPING "./postgres-data" TO "/var/lib/postgresql/data"
END SERVICE
```

**Output (`docker-compose.yml`):**
```yaml
# Generated by Athena v0.1.0 from FASTAPI_PROJECT deployment
# Project Version: 2.0.0
# Generated: 2025-09-13 20:45:28 UTC
# Features: Intelligent defaults, optimized networking, enhanced health checks
# DO NOT EDIT MANUALLY - This file is auto-generated

services:
  backend:
    build:                    # ‚Üê Dockerfile auto-detected!
      context: .
      dockerfile: Dockerfile
    container_name: fastapi-project-backend
    ports:
      - 8000:8000
    environment:
      DATABASE_URL: ${DATABASE_URL}
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000
    depends_on:
      - database
    healthcheck:              # ‚Üê Enhanced health check!
      test: [CMD-SHELL, "curl -f http://localhost:8000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped   # ‚Üê Smart default for web apps
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
      restart_policy:         # ‚Üê Production restart policy
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
    networks:
      - fastapi_network
    pull_policy: missing
    labels:                   # ‚Üê Metadata for tracking
      athena.type: generic
      athena.project: FASTAPI_PROJECT
      athena.service: backend
      athena.generated: 2025-09-13
      
  database:
    image: postgres:15
    container_name: fastapi-project-database
    ports:
      - 5432:5432
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - ./postgres-data:/var/lib/postgresql/data
    restart: always          # ‚Üê Smart default for databases
    networks:
      - fastapi_network
    labels:
      athena.type: database  # ‚Üê Auto-detected service type
      athena.project: FASTAPI_PROJECT

networks:
  fastapi_network:
    driver: bridge

name: FASTAPI_PROJECT       # ‚Üê Modern Docker Compose naming
```

### üéØ **What Athena Adds Automatically**

- **Smart service detection** (Database, Cache, WebApp, Proxy)
- **Optimized health checks** with service-specific intervals
- **Production restart policies** based on service type  
- **Modern container naming** (`project-service`)
- **Metadata labels** for tracking and management
- **Resource management** with deploy sections
- **Network isolation** with custom networks
- **Dockerfile integration** when no image specified
- **Dependency ordering** with topological sort

## üß¨ Boilerplate Project Generator

Generate production-ready full-stack applications with modern best practices.

### FastAPI Projects
```bash
# FastAPI + PostgreSQL
athena init fastapi my-api --with-postgresql

# FastAPI + MongoDB (default)
athena init fastapi my-api --with-mongodb

# Without Docker files
athena init fastapi my-api --no-docker
```

**Generated FastAPI Structure:**
```
my-api/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI application
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py        # Settings management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py      # JWT + password hashing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py      # Async database config
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ v1/             # API versioning
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py     # Authentication endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ users.py    # User management
‚îÇ   ‚îú‚îÄ‚îÄ models/             # Database models
‚îÇ   ‚îú‚îÄ‚îÄ schemas/            # Pydantic models
‚îÇ   ‚îî‚îÄ‚îÄ services/           # Business logic
‚îú‚îÄ‚îÄ tests/                  # Comprehensive test suite
‚îú‚îÄ‚îÄ nginx/                  # Reverse proxy config
‚îú‚îÄ‚îÄ logs/                   # Application logs
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ Dockerfile             # Production Docker build
‚îú‚îÄ‚îÄ docker-compose.yml     # Full stack deployment
‚îî‚îÄ‚îÄ .env.example          # Environment template
```

### Go Projects
```bash
# Go + Gin (default)
athena init go my-service

# Go + Echo framework
athena init go my-service --framework echo --with-postgresql

# Go + Fiber framework
athena init go my-service --framework fiber --with-mongodb
```

**Generated Go Structure:**
```
my-service/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ main.go         # Application entrypoint
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/            # Configuration management
‚îÇ   ‚îú‚îÄ‚îÄ handler/           # HTTP handlers
‚îÇ   ‚îú‚îÄ‚îÄ middleware/        # Custom middleware
‚îÇ   ‚îú‚îÄ‚îÄ model/            # Data models
‚îÇ   ‚îú‚îÄ‚îÄ repository/       # Data access layer
‚îÇ   ‚îî‚îÄ‚îÄ service/          # Business logic
‚îú‚îÄ‚îÄ pkg/                   # Public packages
‚îú‚îÄ‚îÄ tests/                 # Test suite
‚îú‚îÄ‚îÄ scripts/               # Build & deployment scripts
‚îú‚îÄ‚îÄ Dockerfile            # Production build
‚îú‚îÄ‚îÄ docker-compose.yml    # Development environment
‚îú‚îÄ‚îÄ go.mod               # Go modules
‚îî‚îÄ‚îÄ .env.example         # Environment template
```

### Flask Projects
```bash
# Flask + PostgreSQL
athena init flask my-app --with-postgresql

# Flask + MongoDB
athena init flask my-app --with-mongodb
```

## üìñ DSL Reference

### File Structure
```cobol
DEPLOYMENT-ID project_name    # Required: Project identifier
VERSION-ID version           # Optional: Project version

ENVIRONMENT SECTION          # Optional: Environment configuration
NETWORK-NAME custom_network  # Optional: Custom network name

SERVICES SECTION             # Required: Service definitions

SERVICE service_name         # Service block start
# Service directives here
END SERVICE                  # Service block end
```

### Service Directives

| Directive | Description | Example |
|-----------|-------------|---------|
| `IMAGE-ID` | Docker image (if no Dockerfile) | `IMAGE-ID postgres:15` |
| `PORT-MAPPING` | Port forwarding | `PORT-MAPPING 8000 TO 8000` |
| `ENV-VARIABLE` | Environment variable | `ENV-VARIABLE {{DATABASE_URL}}` |
| `COMMAND` | Container command | `COMMAND "npm start"` |
| `DEPENDS-ON` | Service dependency | `DEPENDS-ON database` |
| `HEALTH-CHECK` | Health check command | `HEALTH-CHECK "curl -f http://localhost/health"` |
| `RESTART-POLICY` | Restart behavior | `RESTART-POLICY unless-stopped` |
| `RESOURCE-LIMITS` | CPU/Memory limits | `RESOURCE-LIMITS CPU "0.5" MEMORY "512M"` |
| `VOLUME-MAPPING` | Volume mount | `VOLUME-MAPPING "./data" TO "/app/data"` |

### Smart Defaults by Service Type

| Service Type | Auto-Detection | Restart Policy | Health Check Interval |
|--------------|----------------|----------------|---------------------|
| **Database** | `postgres`, `mysql`, `mongodb` | `always` | `10s` |
| **Cache** | `redis`, `memcached` | `always` | `15s` |
| **Proxy** | `nginx`, `apache`, `traefik` | `always` | `20s` |
| **WebApp** | `node`, `python`, `java` | `unless-stopped` | `30s` |
| **Generic** | Other images or Dockerfile | `unless-stopped` | `30s` |

## üéØ Examples

### Microservices Architecture
```cobol
DEPLOYMENT-ID ECOMMERCE_STACK
VERSION-ID 3.1.0

ENVIRONMENT SECTION
NETWORK-NAME ecommerce_net

SERVICES SECTION

SERVICE api_gateway
IMAGE-ID nginx:alpine
PORT-MAPPING 80 TO 80
PORT-MAPPING 443 TO 443
VOLUME-MAPPING "./nginx/conf.d" TO "/etc/nginx/conf.d" (ro)
DEPENDS-ON users_service
DEPENDS-ON products_service
END SERVICE

SERVICE users_service
PORT-MAPPING 3001 TO 3000
ENV-VARIABLE {{JWT_SECRET}}
ENV-VARIABLE {{DATABASE_URL}}
DEPENDS-ON users_db
HEALTH-CHECK "curl -f http://localhost:3000/health"
RESOURCE-LIMITS CPU "0.5" MEMORY "512M"
END SERVICE

SERVICE products_service
PORT-MAPPING 3002 TO 3000
ENV-VARIABLE {{DATABASE_URL}}
DEPENDS-ON products_db
HEALTH-CHECK "curl -f http://localhost:3000/health"
RESOURCE-LIMITS CPU "0.7" MEMORY "768M"
END SERVICE

SERVICE users_db
IMAGE-ID postgres:15
PORT-MAPPING 5433 TO 5432
ENV-VARIABLE {{POSTGRES_USER}}
ENV-VARIABLE {{POSTGRES_PASSWORD}}
ENV-VARIABLE {{POSTGRES_DB}}
VOLUME-MAPPING "./users-data" TO "/var/lib/postgresql/data"
END SERVICE

SERVICE products_db
IMAGE-ID postgres:15
PORT-MAPPING 5434 TO 5432
ENV-VARIABLE {{POSTGRES_USER}}
ENV-VARIABLE {{POSTGRES_PASSWORD}}
ENV-VARIABLE {{POSTGRES_DB}}
VOLUME-MAPPING "./products-data" TO "/var/lib/postgresql/data"
END SERVICE

SERVICE redis_cache
IMAGE-ID redis:7-alpine
PORT-MAPPING 6379 TO 6379
VOLUME-MAPPING "./redis-data" TO "/data" (rw)
COMMAND "redis-server --appendonly yes"
END SERVICE
```

### Development Stack with Hot Reload
```cobol
DEPLOYMENT-ID DEV_STACK

SERVICES SECTION

SERVICE frontend
PORT-MAPPING 3000 TO 3000
ENV-VARIABLE {{REACT_APP_API_URL}}
COMMAND "npm run dev"
VOLUME-MAPPING "./src" TO "/app/src" (rw)
DEPENDS-ON backend
END SERVICE

SERVICE backend
PORT-MAPPING 8000 TO 8000
ENV-VARIABLE {{DATABASE_URL}}
ENV-VARIABLE {{DEBUG}}
COMMAND "uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
VOLUME-MAPPING "./app" TO "/app/app" (rw)
DEPENDS-ON db
END SERVICE

SERVICE db
IMAGE-ID postgres:15
PORT-MAPPING 5432 TO 5432
ENV-VARIABLE {{POSTGRES_USER}}
ENV-VARIABLE {{POSTGRES_PASSWORD}}
ENV-VARIABLE {{POSTGRES_DB}}
VOLUME-MAPPING "./postgres-data" TO "/var/lib/postgresql/data"
END SERVICE
```

## üèóÔ∏è Architecture

### Core Components

```
athena/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ cli/                    # Command-line interface
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ args.rs            # Argument parsing
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.rs        # Command implementations  
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.rs           # CLI utilities
‚îÇ   ‚îú‚îÄ‚îÄ athena/                # Core functionality
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser/            # DSL parsing
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grammar.pest   # COBOL-inspired grammar
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ast.rs         # Abstract syntax tree
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ parser.rs      # Parser implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ optimized_parser.rs # Performance optimizations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generator/         # Docker Compose generation
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ compose.rs     # Main generator
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ defaults.rs    # Intelligent defaults engine
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ error.rs           # Typed error handling
‚îÇ   ‚îú‚îÄ‚îÄ boilerplate/           # Project generators
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fastapi.rs         # FastAPI project generator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ go.rs              # Go project generator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ flask.rs           # Flask project generator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates.rs       # Embedded templates
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.rs           # Template utilities
‚îÇ   ‚îî‚îÄ‚îÄ main.rs                # Application entrypoint
‚îú‚îÄ‚îÄ tests/                     # Test suite
‚îÇ   ‚îú‚îÄ‚îÄ integration/           # CLI integration tests
‚îÇ   ‚îî‚îÄ‚îÄ fixtures/              # Test .ath files
‚îî‚îÄ‚îÄ examples/                  # Example configurations
```

### Performance Features
- **Fast parsing** using Pest grammar (<1ms)
- **Topological sorting** for dependency resolution
- **Iterative validation** preventing stack overflow
- **Memory-efficient** AST representation
- **Optimized YAML generation** (<2ms)

### Security Features
- **Input validation** at parser level
- **No code injection** in generated YAML
- **Safe file handling** with proper error propagation
- **Secure defaults** in generated configurations

## üîß Development

### Building from Source
```bash
# Debug build
cargo build

# Release build (optimized)
cargo build --release

# Install locally
cargo install --path .
```

### Running Tests
```bash
# All tests
cargo test

# Integration tests only
cargo test integration

# Specific test with output
cargo test test_enhanced_compose_generation -- --nocapture
```

### Development Commands
```bash
# Development cycle with tests
make dev

# Install and run demo
make demo

# Check installation
make check-install

# Clean build artifacts
make clean
```

### Project Standards
- **Rust 2021 Edition** with latest stable compiler
- **Error handling** using `thiserror` for typed errors
- **CLI framework** using `clap` v4 with derive macros
- **Parsing** using `pest` for grammar-based parsing
- **YAML generation** using `serde_yaml` for safe serialization
- **Testing** using `assert_cmd` for CLI integration tests

### Contributing
1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Make changes with tests
4. Run `cargo test` and `cargo clippy`
5. Commit changes (`git commit -m 'Add amazing feature'`)
6. Push to branch (`git push origin feature/amazing-feature`)
7. Open a Pull Request

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- **Pest** for powerful parsing capabilities
- **Clap** for excellent CLI framework
- **Docker Community** for container standards
- **Rust Community** for the amazing ecosystem

---

**Built with ‚ù§Ô∏è using Rust | Production-ready DevOps made simple**
