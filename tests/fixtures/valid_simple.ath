DEPLOYMENT-ID SIMPLE_TEST_APP
VERSION-ID 1.0.0

ENVIRONMENT SECTION
NETWORK-NAME simple_test_network

SERVICES SECTION

SERVICE web
IMAGE-ID nginx:alpine
PORT-MAPPING 8080 TO 80
ENV-VARIABLE {{NGINX_HOST}}
ENV-VARIABLE {{NGINX_PORT}}
HEALTH-CHECK "curl -f http://localhost:80/health || exit 1"
RESTART-POLICY unless-stopped
END SERVICE

SERVICE app
IMAGE-ID python:3.11-slim
PORT-MAPPING 5000 TO 5000
ENV-VARIABLE {{DATABASE_URL}}
ENV-VARIABLE {{SECRET_KEY}}
COMMAND "python app.py"
DEPENDS-ON database
HEALTH-CHECK "curl -f http://localhost:5000/health || exit 1"
RESTART-POLICY unless-stopped
END SERVICE

SERVICE database
IMAGE-ID postgres:15
PORT-MAPPING 5432 TO 5432
ENV-VARIABLE {{POSTGRES_USER}}
ENV-VARIABLE {{POSTGRES_PASSWORD}}
ENV-VARIABLE {{POSTGRES_DB}}
VOLUME-MAPPING "./data" TO "/var/lib/postgresql/data"
RESTART-POLICY always
END SERVICE